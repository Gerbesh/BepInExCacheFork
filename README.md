# BepInEx.CacheFork

–§–æ—Ä–∫ **BepInEx 5.4.23.3** –¥–ª—è Valheim —Å **persistent caching**, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–æ–≤ –≤ 5‚Äì10 —Ä–∞–∑ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

## üìä –°—Ç–∞—Ç—É—Å

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 99%**

- ‚úÖ **–ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:** BepInEx 5.4.23.3 (stable, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å 200+ –º–æ–¥–∞–º–∏)
- ‚úÖ **–ö–µ—à –∞—Å—Å–µ–º–±–ª–µ–π:** –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ patched DLL (MonoMod/Harmony)
- ‚úÖ **–ö–µ—à –∞—Å—Å–µ—Ç–æ–≤:** Extracted AssetBundle (LZ4/Uncompressed) —Å on-demand —Ä–µ–∂–∏–º–æ–º
- ‚úÖ **–ö–µ—à –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏:** XUnity AutoTranslator + Jotunn –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ **–ö–µ—à —Å–æ—Å—Ç–æ—è–Ω–∏—è:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Valheim registries (ObjectDB, Jotunn ItemManager –∏ —Ç.–¥.)
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç XUnity –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- ‚úÖ **Diagnostics & Metrics:** –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏, timing –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–≤–æ–¥–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ **Fallback & Recovery:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **Cache Hit:** –ü—Ä–∏ cache hit –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–æ–≤ –∑–∞ 10‚Äì30 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 10+ –º–∏–Ω (–Ω–∞ 100+ –º–æ–¥–∞—Ö)
- **Auto-rebuild:** –ö–µ—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –º–æ–¥–æ–≤/–≤–µ—Ä—Å–∏–∏ –∏–≥—Ä—ã
- **100% –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –í—Å–µ –ø–ª–∞–≥–∏–Ω—ã BepInEx —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **Zero-config:** –ö–µ—à –≤–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- **Thread-safe:** –ë–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –∏–≥—Ä—ã
- **Extracted assets:** On-demand –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ AssetBundle —Å –ø—Ä–æ–≥—Ä–µ–≤–∫–æ–π –û–°-–∫—ç—à–∞

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥—ã –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏
- ‚úÖ **Jotunn** (2.27.0+): –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å –∫–µ—à–µ–º registries
- ‚úÖ **XUnity AutoTranslator**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ
- ‚úÖ **Jewelcrafting**: –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–∏ XUnity –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö
- ‚úÖ **AzuCraftyBoxes**: Guard –æ—Ç NRE –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ m_shared
- ‚úÖ **–õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã**: 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
BepInEx.CacheFork/
‚îú‚îÄ‚îÄ BepInEx/                    # –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ BepInEx 5.4.23.3
‚îú‚îÄ‚îÄ BepInEx.Bootstrap/          # Bootstrapper
‚îú‚îÄ‚îÄ BepInEx.Cache.Core/         # ‚≠ê –Ø–¥—Ä–æ –∫–µ—à–∞ (30+ –ø–∞—Ç—á–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ CacheManager.cs         # –ì–ª–∞–≤–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ CacheFingerprint.cs     # –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ ExtractedAssetCache.cs  # –ö–µ—à extracted –∞—Å—Å–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ JotunnStateCachePatcher.cs
‚îÇ   ‚îú‚îÄ‚îÄ JewelcraftingNullSafePatcher.cs  # XUnity –∑–∞—â–∏—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ç—á–∏)
‚îú‚îÄ‚îÄ BepInEx.Preloader/          # Preloader —Å –∫–µ—à –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ runtime/                    # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ –¥–ª—è Valheim
‚îú‚îÄ‚îÄ cache.cfg                   # –ö–æ–Ω—Ñ–∏–≥ –∫–µ—à–∞ (—à–∞–±–ª–æ–Ω)
‚îú‚îÄ‚îÄ README.md                   # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ BUILDING.md                 # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–±–æ—Ä–∫–∏
‚îî‚îÄ‚îÄ AGENTS.md                   # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `BepInEx/cache.cfg` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):

```ini
[Cache]
EnableCache=true
ValidateStrict=false
CacheDir=auto
MaxCacheSizeBytes=17179869184

[ExtractedAssets]
ExtractHeavyAssets=true
PreferredCompression=LZ4
BackgroundWarmup=true
WarmupMaxMB=3000

[Diagnostics]
VerboseDiagnostics=false
FingerprintMode=Fast
SuppressPluginLoadLogs=true
```

**–ö–ª—é—á–µ–≤—ã–µ –æ–ø—Ü–∏–∏:**
- `EnableCache` ‚Äî –≤–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –∫–µ—à
- `ValidateStrict` ‚Äî —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏)
- `ExtractHeavyAssets` ‚Äî –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ extracted AssetBundle
- `VerboseDiagnostics` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
1. –°–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ `BepInEx.CacheFork.Valheim.zip`
2. –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –ø–æ–≤–µ—Ä—Ö Valheim
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É ‚Äî –∫–µ—à —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞
- –û—Ç–∫—Ä–æ–π—Ç–µ `BepInEx/LogOutput.log` –∏ –Ω–∞–π–¥–∏—Ç–µ:
  ```
  CacheFork: Cache hit! Loaded 85 items in 0.523s
  CacheFork: Total speedup: 340% (cache: 0.5s, uncached: 1.7s)
  ```

### –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
```bash
# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
rm -rf BepInEx/cache/*

# –ò–ª–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ Valheim
cache.clear
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ù–∞ –ø—Ä–∏–º–µ—Ä–µ 100+ –º–æ–¥–æ–≤ (i7, SSD)

| –°—Ü–µ–Ω–∞—Ä–∏–π | –í—Ä–µ–º—è |
|----------|----------|
| **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ –∫–µ—à–∞)** | 10‚Äì15 –º–∏–Ω |
| **Cache miss (–º–æ–¥—ã –∏–∑–º–µ–Ω–µ–Ω—ã)** | 3‚Äì5 –º–∏–Ω (rebuild) |
| **Cache hit (–º–æ–¥—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã)** | **20‚Äì40 —Å–µ–∫** |
| **–°–ø–∏–¥–∞–ø** | **15‚Äì30x** |

### –†–∞–∑–º–µ—Ä –∫–µ—à–∞
- –°—Ä–µ–¥–Ω–∏–π: 500 MB ‚Äì 2 GB
- –ú–∞–∫—Å–∏–º—É–º: ~20% –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –º–æ–¥–æ–≤
- Compressed: LZ4 (default)

## üîß –°–±–æ—Ä–∫–∞

–°–º–æ—Ç—Ä–∏ [BUILDING.md](BUILDING.md) –¥–ª—è –ø–æ–ª–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.

**–ë—ã—Å—Ç—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (Windows):**
```powershell
.\build.ps1 -target=Build
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ dotnet:**
```bash
dotnet build -c Release
```

–°–±–æ—Ä–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `bin/Release/net35/`.

## üìã –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ‚Äî —Å–º. [LICENSE](LICENSE)

–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ [BepInEx](https://github.com/BepInEx/BepInEx) (MIT).

## ü§ù –í–∫–ª–∞–¥

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è –æ—Ç—á—ë—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö, —Å–æ–æ–±—â–µ–Ω–∏—è –æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—è—Ö –∏ PR.

–°–º–æ—Ç—Ä–∏ [CONTRIBUTING.md](CONTRIBUTING.md) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
